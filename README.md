# File Integrity Monitor

Приложение на C++/Qt для мониторинга целостности файлов с хранением состояния в SQLite. GUI работает как обычное окно и как фоновый сервис в системном трее: таймер запускает сканирование без блокировки интерфейса, а результаты сохраняются в базу.

## Возможности
- Хеширование файлов (SHA-256) и сравнение с предыдущими значениями.
- Хранение истории хешей и метаданных в локальной базе SQLite (`integrity.db`).
- Фиксация изменений прав доступа, владельца, группы, mtime и inode, включая пометку удалённых файлов.
- Добавление и удаление каталогов для сканирования через GUI.
- Просмотр последних результатов и загруженной из базы истории.
- Фоновый мониторинг через системный трей с уведомлениями.

## Структура проекта
```
CMakeLists.txt        # сборка проекта
core/
  FileIntegrityEngine # ядро сканирования
src/
  main.cpp            # запуск приложения
  MainWindow.*        # графический интерфейс + трэй/таймер
  DatabaseManager.*   # работа с SQLite
  FileMonitor.*       # подсчёт хешей и логика сканирования
  ScanWorker.*        # фоновая работа в отдельном потоке
```

## Сборка
1. Убедитесь, что установлены Qt (5 или 6) с компонентами Widgets, Gui и Sql, а также CMake 3.16+ и компилятор C++17.
2. Соберите проект:
   ```bash
   mkdir -p build
   cd build
   cmake ..
   cmake --build .
   ```
3. Запустите приложение:
   ```bash
   ./file_integrity_monitor
   ```

## Запуск и фоновая работа
- При закрытии окна приложение сворачивается в системный трей и продолжает мониторинг.
- Меню трея: **Открыть**, **Запустить сканирование сейчас**, **Пауза/Возобновить мониторинг**, **Выход**.
- Таймер фонового сканирования использует интервал из настроек (по умолчанию 300 секунд). Если окно закрыто, уведомления о найденных изменениях/ошибках приходят через balloon pop-up.

## Настройки и пути (user mode)
- Конфигурация и состояние хранятся в XDG-директориях пользователя:
  - Конфиг: `QStandardPaths::writableLocation(QStandardPaths::AppConfigLocation)/file_integrity_monitor.conf`.
  - База: `QStandardPaths::writableLocation(QStandardPaths::AppDataLocation)/integrity.db`.
- Если конфиг отсутствует, создаётся безопасный дефолтный.
- Сохраняемые параметры:
  - `monitoredDirectories` — список директорий.
  - `intervalSeconds` — интервал фонового сканирования.
  - `excludeRules` — правила `path:` и `glob:`.

## Использование
1. Запустите программу и добавьте один или несколько каталогов (кнопки "Browse" или "Add").
2. Нажмите "Scan" (или пункт в трее) — приложение вычислит SHA-256 для файлов, сравнит с сохранёнными значениями и обновит таблицу.
3. Настройте интервал в боковой панели, при необходимости укажите исключения.
4. Закройте окно: приложение останется в трее и продолжит периодические проверки по таймеру.
